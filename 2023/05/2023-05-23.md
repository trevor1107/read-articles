# 2023-05-23 (화)

- [자바스크립트에서 타임존 다루기(1): NHN Cloud Meetup](#자바스크립트에서-타임존-다루기1-nhn-cloud-meetup)
  - [타임존 !== 오프셋?](#타임존--오프셋)
  - [서머 타임 (DST)](#서머-타임-dst)
  - [IANA time zone database](#iana-time-zone-database)
  - [자바스크립트와 IANA time zone database](#자바스크립트와-iana-time-zone-database)
- [자바스크립트에서 타임존 다루기 (2)](#자바스크립트에서-타임존-다루기-2)
  - [Moment Timezone](#moment-timezone)

## 자바스크립트에서 타임존 다루기(1): NHN Cloud Meetup

<https://meetup.nhncloud.com/posts/125>

🌍 자바스크립트에서 타임존을 다룰 때의 문제와 해결방법에 대한 내용을 정리한 글입니다. 1부에서는 타임존과 관련 표준을 다루고, 2부에서는 자바스크립트와 관련된 내용을 설명합니다.

- ⏰ 타임존은 동일한 로컬 시간을 따르는 지역을 의미하며, 국가에 의해 지정됩니다.
- 🌐 GMT은 영국 그리니치 천문대를 기준으로 하는 태양 시간을 의미하며, UTC와 혼용되어 사용됩니다.
- ⏱️ UTC는 지구 자전주기의 변화를 해결하기 위해 1972년에 세슘 원자의 진동수를 기준으로 지정된 시간대입니다.
- 🕒 오프셋은 UTC를 기준으로 얼마나 빠른지 나타내는 값입니다. UTC+09:00는 UTC의 기준 시간보다 9시간이 빠르다는 의미 입니다.

### 타임존 !== 오프셋?

앞서 말했듯이 우리가 타임존을 말할 때는 보통 KST, JST(Japan Standard Time) 등과 같이 오프셋과 동일한 의미로 쓰인다. 하지만, 특정 지역의 타임존을 단순히 오프셋이라고 지칭하기는 어려운데, 이는 아래의 두 가지 이유 때문이다.

### 서머 타임 (DST)

국내에서는 여전히 생소한 개념이지만, 해외 여러 국가에서는 서머 타임(summer time)이 존재한다. 사실 서머 타임은 주로 영국에나 유럽에서 쓰이는 용어인데, 좀더 범용적인 용어로는 일광 시간 절약제, 즉 DST(Daylight Saving Time)라고 불린다. 이는 하절기에 표준시를 원래 시간보다 한 시간 앞당긴 시간으로 이용하는 것을 의미한다.

앞에서도 잠깐 언급했었지만, 각 지역이 어떤 타임존을 이용할 지는 해당 지역 혹은 국가가 법적으로 결정하기 때문에, 정치적 혹은 경제적 이유로 변경될 수 있다.

그러면 우리는 특정 지역의 타임존을 오프셋이 아닌 무엇으로 지칭해야 할까? 바로 지역명이다. 정확히 이야기하면 **역사적으로 표준시간대나 DST의 변경이 동일하게 적용되었던 지역**을 하나의 타임존으로 묶어서 지칭할 수 있을 것이다.

### IANA time zone database

사실 타임존에 대한 표준은 단순히 규칙이기 보다는 데이터베이스에 가까운데, 역사적인 변경 내역을 모두 저장하고 있어야 하기 때문이다. 이러한 표준 데이터베이스는 여럿이 있지만, 현재로서 가장 신뢰할 수 있는 표준은 바로 [IANA time zone database](https://www.iana.org/time-zones) 이다. IANA time zone database는 보통 tz database (혹은 tzdata) 라고 불리며, 전 세계 모든 지역의 표준시와 DST 변경 내역을 담고 있다. 현재 역사적으로 확인할 수 있는 모든 데이터가 들어있다고 볼 수 있는데, UNIX 시간(1970.01.01 00:00:00) 이후의 데이터의 정확도를 보장하도록 정리되었다. (즉, 1970년 이전의 데이터도 있지만 이 시기의 데이터는 완벽한 정확성을 보장하지는 않는다)

### 자바스크립트와 IANA time zone database

설치된 OS에 설정된 타임존을 따르게 되어 있다. 자바스크립트에서 명시적으로 타임존을 변경할 수 있는 방법이 없다. 뿐만 아니라 데이터베이스 표준에 대한 명세도 명확하지 않다.

## 자바스크립트에서 타임존 다루기 (2)

<https://meetup.nhncloud.com/posts/130>

먼저, 클라이언트 환경에서 사용자가 등록 페이지에서 입력박스에 일정(날짜 및 시간) 입력하면, 그 정보를 서버로 전송해서 DB에 저장된다. 그리고 목록 페이지에서는 클라이언트가 다시 서버로부터 등록된 일정의 정보를 받아와서 화면에 보여주게 된다.

이때 유의할 점은, 서버에 저장된 동일한 데이터에 접근하는 클라이언트들이 서로 다른 타임존을 갖고 있을 수 있다는 점이다. 서버에 저장되는 데이터가 타임존에 영향을 받지 않는 절대값이어야 한다.

일반적으로 이런 데이터는 UTC를 기준으로 한 [유닉스 시간](https://en.wikipedia.org/wiki/Unix_time)이나 오프셋 정보가 포함된 [ISO-8601](https://en.wikipedia.org/wiki/ISO_8601)와 같은 형태로 전송하게 된다. 예시로 서울의 2017년 3월 10일 오후 9시 30분은 유닉스 시간을 이용한다면 숫자 타입의 `1489113000` 이 될 것이고, ISO-8601을 이용한다면 문자열 타입의 `2017-03-10T11:30:00+09:00` 가 될 것이다.

브라우저 환경에서 자바스크립트를 이용해 이러한 처리를 해야 한다면, 우리는 사용자의 입력 값을 위와 같은 형식으로 변환하는 파싱(Parsing) 작업과, 위와 같은 형식의 데이터를 받아서 사용자의 타임존에 맞게 변환하는 작업 포맷팅(Formatting) 두 가지를 모두 고려해야 한다.

### Moment Timezone

[Moment](https://momentjs.com/)는 자바스크립트에서 날짜 연산을 할 때 거의 표준처럼 자리잡은 라이브러리이다. 다양한 날짜 연산 및 포맷팅 API를 제공하며, 최근 많은 사용자들에 의해 널리 사용되면서 안정성도 검증받았다고 할 수 있다. 또한 [Moment Timezone](https://momentjs.com/timezone/) 이라는 확장 모듈을 이용하면 위에서 말한 문제들을 간단하게 해결할 수 있다. 이 확장 모듈은 실제 IANA timezone Database 의 데이터를 내장하여 실제 오프셋을 정확히 계산해주며, 타임존을 변경하고 포맷팅 할 수 있는 다양한 API를 제공한다.

지금까지 자바스크립트에서 지원하는 타임존 관련 API들과, 관련된 문제점들을 살펴보았다. 로컬 타임존을 직접 변경할 필요가 없다면, IE9 이상의 브라우저에 한해서 기본 API 만으로도 필요한 기능들을 구현할 수 있을 것이다. 하지만, 로컬 타임존을 직접 변경해야 한다면 문제는 복잡해진다. 서머 타임이 없고, 타임존 정책에 변경이 거의 없는 지역에 대해서는 위에서 설명한 것 처럼 `getTimezoneOffset()` 을 활용한 데이터 변환으로 불완전하게나마 구현이 가능하다. 하지만, 다양한 지역에 대한 타임존을 제대로 지원하고 싶다면, 직접 구현하려는 욕심을 버리고 Moment Timezone과 같은 라이브러리를 활용하는 것이 나을 것이다.
